<html>

<head>
  <title>Docker Exec Web Console</title>
  <meta name="viewport" content="width=device-width, initial-scale=0.7,maximum-scale=1">
  <link href="https://cdn.bootcss.com/xterm/2.9.2/xterm.min.css" rel="stylesheet">
  <script src="https://cdn.bootcss.com/xterm/2.9.2/xterm.min.js"></script>
  <script src="https://cdn.bootcss.com/xterm/2.9.2/addons/fit/fit.min.js"></script>
  <style>
    body {
      padding: 0;
      margin: 5px;
      background-color: #000;
    }
    
    #terminal {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
    }
  </style>

</head>

<body>
  <div id="terminal"></div>

  <script type="text/javascript">
    var term, websocket, containerId = '',
      command = '';
    var terminal = document.getElementById('terminal')

    function getQueryVar(variable) {
      var query = window.location.search.substring(1);
      var vars = query.split("&");
      for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split("=");
        if (pair[0] == variable) {
          return pair[1];
        }
      }

      return false;
    }

    containerId = getQueryVar('cid');
    if (!containerId) {
      containerId = prompt('Container ID');
    }

    command = getQueryVar('cmd');
    if (!command) {
      command = '/bin/bash';
    }

    websocket = new WebSocket((window.location.protocol.indexOf("https") == 0 ? "wss" : "ws") + "://" + window.location.hostname + ":" + window.location.port + window.location.pathname + "exec/" + containerId + ',' + window.btoa(command));

    websocket.onopen = function(evt) {
      term = new Terminal({
        //cols: 100,
        //rows: 30,
        scrollback: 10000,
        screenKeys: true,
        useStyle: true,
        cursorBlink: true,
      });

      term.on('data', function(data) {
        websocket.send(data);
      });

      term.on('title', function(title) {
        document.title = title;
      });

      term.open(terminal);

      websocket.onmessage = function(evt) {
        term.write(evt.data);
      }

      websocket.onclose = function(evt) {
        term.write("Session terminated");
        term.destroy();
      }

      websocket.onerror = function(evt) {
        if (typeof console.log == "function") {
          console.log(evt)
        }
      }
      term.fit()
      window.onresize = function() {
        term.fit()
      }
    }
  </script>
</body>

</html>